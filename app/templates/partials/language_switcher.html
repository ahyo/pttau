{% set active_lang = lang or settings.DEFAULT_LANG %}
{% set options = language_options %}
{% set active_option = options | selectattr('code', 'equalto', active_lang) | list | first %}
<div class="lang-switcher" data-lang-switcher>
  <button type="button" class="lang-switcher__btn lang-switcher__toggle" data-lang-toggle>
    <span>{{ active_option.flag if active_option else 'üåê' }}</span>
  </button>
  <div class="lang-switcher__menu" data-lang-menu>
    {% for option in options %}
      {% if option.code != active_lang %}
      <a href="/set-lang/{{ option.code }}" class="lang-switcher__btn" data-lang-option>
        <span>{{ option.flag }}</span>
        <span class="visually-hidden">{{ option.label }}</span>
      </a>
      {% endif %}
    {% endfor %}
  </div>
</div>
<script>
  (function(){
    const container = document.querySelector('[data-lang-switcher]');
    if(!container || container.dataset.bound){return;}
    container.dataset.bound = '1';
    const toggle = container.querySelector('[data-lang-toggle]');
    const menu = container.querySelector('[data-lang-menu]');
    const closeMenu = ()=>{menu.classList.remove('is-open');};
    toggle.addEventListener('click', (e)=>{
      e.stopPropagation();
      menu.classList.toggle('is-open');
    });
    menu.addEventListener('click', (e)=>{
      e.stopPropagation();
    });
    menu.querySelectorAll('[data-lang-option]').forEach((option)=>{
      option.addEventListener('click', closeMenu);
    });
    document.addEventListener('click', closeMenu);
  })();
</script>
