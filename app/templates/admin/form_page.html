{% extends "layouts/base.html" %}
{% block title %}{{ 'Create' if mode=='create' else 'Edit' }} Page â€” {{ settings.APP_NAME if settings else 'Site' }}{% endblock %}
{% block content %}
{% set data = form_data if form_data else {} %}
{% set current = page if page else None %}
{% set translations = translation_form if (translation_form is defined and translation_form) else {} %}
{% set translation_langs = translation_langs if translation_langs is defined else language_options[1:] %}
<section class="py-4">
  <div class="container">
    <h1 class="h5 mb-3">{{ 'Create' if mode=='create' else 'Edit' }} Page</h1>
    {% if error %}
    <div class="alert alert-danger">{{ error }}</div>
    {% endif %}
    <form method="post">
      <div class="row g-3">
        <div class="col-md-4">
          <label class="form-label">Slug</label>
          <input
            name="slug"
            class="form-control"
            value="{{ data.get('slug', current.slug if current else '') }}"
            placeholder="otomatis dari judul bila kosong"
          >
        </div>
        <div class="col-md-4">
          <label class="form-label">Template</label>
          {% set sel = data.get('template', current.template if current else 'about') %}
          <select name="template" class="form-select">
            {% for t in ['about','contact','custom'] %}
              <option value="{{t}}" {{ 'selected' if t==sel else '' }}>{{ t }}</option>
            {% endfor %}
          </select>
        </div>
        <div class="col-md-4 d-flex align-items-end">
          {% set pub = data.get('is_published', 'on' if (current.is_published if current else True) else 'off') %}
          <div class="form-check">
            <input class="form-check-input" type="checkbox" name="is_published" id="is_pub" {{ 'checked' if pub == 'on' else '' }}>
            <label class="form-check-label" for="is_pub">Published</label>
          </div>
        </div>
      </div>

      <hr class="my-4">

      <div class="row g-3">
        <div class="col-md-6">
          <label class="form-label">Judul Halaman</label>
          <input
            name="title"
            class="form-control"
            value="{{ data.get('title', current.title if current else '') }}"
            required
          >
        </div>
        <div class="col-md-6">
          <label class="form-label">Meta Title (SEO)</label>
          <input
            name="meta_title"
            class="form-control"
            value="{{ data.get('meta_title', current.meta_title if current else '') }}"
          >
        </div>
        <div class="col-12">
          <label class="form-label">Ringkasan Singkat</label>
          <textarea
            name="excerpt"
            class="form-control"
            rows="3"
          >{{ data.get('excerpt', current.excerpt if current else '') }}</textarea>
        </div>
        <div class="col-12">
          <label class="form-label">Konten Halaman</label>
          <textarea
            name="body"
            class="form-control"
            rows="10"
          >{{ data.get('body', current.body if current else '') }}</textarea>
        </div>
        <div class="col-md-6">
          <label class="form-label">Meta Description (SEO)</label>
          <input
            name="meta_desc"
            class="form-control"
            value="{{ data.get('meta_desc', current.meta_desc if current else '') }}"
          >
        </div>
      </div>

      <hr class="my-4">

      <div>
        <div class="d-flex justify-content-between align-items-center mb-3">
          <div>
            <h2 class="h6 mb-1">Terjemahan Konten</h2>
            <p class="text-muted small mb-0">Teks berikut dihasilkan otomatis dari bahasa Indonesia. Silakan perbaiki agar sesuai gaya komunikasi Anda.</p>
          </div>
        </div>
        <ul class="nav nav-pills mb-3" id="pageTranslationTabs" role="tablist">
          {% for lang in translation_langs %}
          {% set is_active = loop.index == 1 %}
          <li class="nav-item" role="presentation">
            <button
              class="nav-link {% if is_active %}active{% endif %}"
              id="page-tab-{{ lang.code }}"
              data-bs-toggle="pill"
              data-bs-target="#page-pane-{{ lang.code }}"
              type="button"
              role="tab"
              aria-controls="page-pane-{{ lang.code }}"
              aria-selected="{{ 'true' if is_active else 'false' }}"
            >{{ lang.label }}</button>
          </li>
          {% endfor %}
        </ul>
        <div class="tab-content" id="pageTranslationPanes">
          {% for lang in translation_langs %}
          {% set is_active = loop.index == 1 %}
          {% set lang_data = translations.get(lang.code, {}) %}
          <div
            class="tab-pane fade {% if is_active %}show active{% endif %}"
            id="page-pane-{{ lang.code }}"
            role="tabpanel"
            aria-labelledby="page-tab-{{ lang.code }}"
          >
            <div class="row g-3">
              <div class="col-md-6">
                <label class="form-label">Judul ({{ lang.label }})</label>
                <input
                  name="title_{{ lang.code }}"
                  class="form-control"
                  value="{{ lang_data.get('title', '') }}"
                  {% if lang.code == 'ar' %}dir="rtl"{% endif %}
                >
              </div>
              <div class="col-md-6">
                <label class="form-label">Meta Title ({{ lang.label }})</label>
                <input
                  name="meta_title_{{ lang.code }}"
                  class="form-control"
                  value="{{ lang_data.get('meta_title', '') }}"
                  {% if lang.code == 'ar' %}dir="rtl"{% endif %}
                >
              </div>
              <div class="col-12">
                <label class="form-label">Ringkasan ({{ lang.label }})</label>
                <textarea
                  name="excerpt_{{ lang.code }}"
                  class="form-control"
                  rows="3"
                  {% if lang.code == 'ar' %}dir="rtl"{% endif %}
                >{{ lang_data.get('excerpt', '') }}</textarea>
              </div>
              <div class="col-12">
                <label class="form-label">Konten Halaman ({{ lang.label }})</label>
                <textarea
                  name="body_{{ lang.code }}"
                  class="form-control"
                  rows="10"
                  {% if lang.code == 'ar' %}dir="rtl"{% endif %}
                >{{ lang_data.get('body', '') }}</textarea>
              </div>
              <div class="col-md-6">
                <label class="form-label">Meta Description ({{ lang.label }})</label>
                <input
                  name="meta_desc_{{ lang.code }}"
                  class="form-control"
                  value="{{ lang_data.get('meta_desc', '') }}"
                  {% if lang.code == 'ar' %}dir="rtl"{% endif %}
                >
              </div>
            </div>
          </div>
          {% endfor %}
        </div>
      </div>

      <div class="mt-3 d-flex gap-2">
        <button class="btn btn-primary">{{ 'Create' if mode=='create' else 'Save Changes' }}</button>
        <a class="btn btn-outline-secondary" href="/admin/pages">Cancel</a>
      </div>
    </form>
  </div>
</section>
{% endblock %}
