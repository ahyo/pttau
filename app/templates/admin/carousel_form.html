{% extends "layouts/base.html" %}
{% block title %}{{ 'Create' if mode=='create' else 'Edit' }} Carousel â€” {{ settings.APP_NAME }}{% endblock %}
{% block content %}
{% set data = form_data if form_data else {} %}
{% set current = item if item else None %}
{% set translations = translation_form if (translation_form is defined and translation_form) else {} %}
{% set translation_langs = translation_langs if translation_langs is defined else language_options[1:] %}
<section class="py-4">
  <div class="container">
    <h1 class="h5 mb-3">{{ 'Create' if mode=='create' else 'Edit' }} Carousel Item</h1>
    <form method="post" enctype="multipart/form-data">
      <div class="row g-3">
        <div class="col-md-3">
          <label class="form-label">Media Type</label>
          {% set mt = data.get('media_type', current.media_type if current else 'image') %}
          <select name="media_type" class="form-select">
            <option value="image" {{ 'selected' if mt=='image' else '' }}>Image</option>
            <option value="video" {{ 'selected' if mt=='video' else '' }}>Video</option>
          </select>
        </div>
        <div class="col-md-3">
          <label class="form-label">Sort Order</label>
          <input type="number" name="sort_order" class="form-control" value="{{ data.get('sort_order', current.sort_order if current else 0) }}">
        </div>
        <div class="col-md-3 d-flex align-items-end">
          <div class="form-check">
            {% set is_active_flag = data.get('is_active') if data else None %}
            {% set active_default = (mode == 'create') or (current and current.is_active) %}
            <input class="form-check-input" type="checkbox" name="is_active" id="is_active" {% if is_active_flag is none %}{% if active_default %}checked{% endif %}{% else %}{% if is_active_flag == 'on' %}checked{% endif %}{% endif %}>
            <label class="form-check-label" for="is_active">Active</label>
          </div>
        </div>
      </div>

      <div class="row g-3 mt-1">
        <div class="col-md-6">
          <label class="form-label">Media File (image/video)</label>
          <input type="file" name="media_file" class="form-control" accept="image/*,video/*">
          {% if current and current.media_path %}
            <small class="text-muted d-block mt-1">Current: {{ current.media_path }}</small>
          {% endif %}
        </div>
        <div class="col-md-6">
          <label class="form-label">Poster (video only)</label>
          <input type="file" name="poster_file" class="form-control" accept="image/*">
          {% if current and current.poster_path %}
            <small class="text-muted d-block mt-1">Current: {{ current.poster_path }}</small>
          {% endif %}
        </div>
      </div>

      <hr class="my-4">

      <div class="row g-3">
        <div class="col-md-6">
          <label class="form-label">Headline</label>
          <input name="title" class="form-control" value="{{ data.get('title', current.title if current else '') }}">
        </div>
        <div class="col-md-6">
          <label class="form-label">CTA URL</label>
          <input name="cta_url" class="form-control" value="{{ data.get('cta_url', current.cta_url if current else '') }}" placeholder="/portfolio">
        </div>
        <div class="col-12">
          <label class="form-label">Sub Headline</label>
          <textarea name="subtitle" class="form-control" rows="3">{{ data.get('subtitle', current.subtitle if current else '') }}</textarea>
        </div>
        <div class="col-md-6">
          <label class="form-label">CTA Text</label>
          <input name="cta_text" class="form-control" value="{{ data.get('cta_text', current.cta_text if current else '') }}" placeholder="Pelajari Lebih Lanjut">
        </div>
      </div>

      <hr class="my-4">

      <div>
        <div class="d-flex justify-content-between align-items-center mb-3">
          <div>
            <h2 class="h6 mb-1">Terjemahan Bahasa</h2>
            <p class="text-muted small mb-0">Konten tombol dan teks akan otomatis diterjemahkan, namun silakan sesuaikan agar terdengar natural.</p>
          </div>
        </div>
        <ul class="nav nav-tabs mb-3" role="tablist">
          {% for lang in translation_langs %}
          {% set is_active = loop.index == 1 %}
          <li class="nav-item" role="presentation">
            <button
              class="nav-link {% if is_active %}active{% endif %}"
              id="carousel-lang-{{ lang.code }}"
              data-bs-toggle="tab"
              data-bs-target="#carousel-pane-{{ lang.code }}"
              type="button"
              role="tab"
              aria-controls="carousel-pane-{{ lang.code }}"
              aria-selected="{{ 'true' if is_active else 'false' }}"
            >{{ lang.label }}</button>
          </li>
          {% endfor %}
        </ul>
        <div class="tab-content">
          {% for lang in translation_langs %}
          {% set is_active = loop.index == 1 %}
          {% set lang_data = translations.get(lang.code, {}) %}
          <div
            class="tab-pane fade {% if is_active %}show active{% endif %}"
            id="carousel-pane-{{ lang.code }}"
            role="tabpanel"
            aria-labelledby="carousel-lang-{{ lang.code }}"
          >
            <div class="row g-3">
              <div class="col-md-6">
                <label class="form-label">Headline ({{ lang.label }})</label>
                <input
                  name="title_{{ lang.code }}"
                  class="form-control"
                  value="{{ lang_data.get('title', '') }}"
                  {% if lang.code == 'ar' %}dir="rtl"{% endif %}
                >
              </div>
              <div class="col-md-6">
                <label class="form-label">CTA Text ({{ lang.label }})</label>
                <input
                  name="cta_text_{{ lang.code }}"
                  class="form-control"
                  value="{{ lang_data.get('cta_text', '') }}"
                  {% if lang.code == 'ar' %}dir="rtl"{% endif %}
                >
              </div>
              <div class="col-12">
                <label class="form-label">Sub Headline ({{ lang.label }})</label>
                <textarea
                  name="subtitle_{{ lang.code }}"
                  class="form-control"
                  rows="3"
                  {% if lang.code == 'ar' %}dir="rtl"{% endif %}
                >{{ lang_data.get('subtitle', '') }}</textarea>
              </div>
            </div>
          </div>
          {% endfor %}
        </div>
      </div>

      <div class="mt-3 d-flex gap-2">
        <button class="btn btn-primary">{{ 'Create' if mode=='create' else 'Save Changes' }}</button>
        <a class="btn btn-outline-secondary" href="/admin/carousel">Cancel</a>
      </div>
    </form>
  </div>
</section>
{% endblock %}
